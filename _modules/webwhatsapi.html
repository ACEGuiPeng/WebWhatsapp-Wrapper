
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>webwhatsapi &#8212; WebWhatsAPI 2.0.1 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for webwhatsapi</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">WebWhatsAPI module</span>

<span class="sd">.. moduleauthor:: Mukul Hase &lt;mukulhase@gmail.com&gt;, Adarsh Sanjeev &lt;adarshsanjeev@gmail.com&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">json</span> <span class="k">import</span> <span class="n">dumps</span><span class="p">,</span> <span class="n">loads</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives.ciphers</span> <span class="k">import</span> <span class="n">Cipher</span><span class="p">,</span> <span class="n">algorithms</span><span class="p">,</span> <span class="n">modes</span>
<span class="kn">from</span> <span class="nn">cryptography.hazmat.backends</span> <span class="k">import</span> <span class="n">default_backend</span>
<span class="kn">from</span> <span class="nn">axolotl.kdf.hkdfv3</span> <span class="k">import</span> <span class="n">HKDFv3</span>
<span class="kn">from</span> <span class="nn">axolotl.util.byteutil</span> <span class="k">import</span> <span class="n">ByteUtil</span>
<span class="kn">from</span> <span class="nn">base64</span> <span class="k">import</span> <span class="n">b64decode</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">BytesIO</span>
<span class="kn">from</span> <span class="nn">selenium</span> <span class="k">import</span> <span class="n">webdriver</span>
<span class="kn">from</span> <span class="nn">selenium.common.exceptions</span> <span class="k">import</span> <span class="n">NoSuchElementException</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.by</span> <span class="k">import</span> <span class="n">By</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.common.desired_capabilities</span> <span class="k">import</span> <span class="n">DesiredCapabilities</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.firefox.options</span> <span class="k">import</span> <span class="n">Options</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support</span> <span class="k">import</span> <span class="n">expected_conditions</span> <span class="k">as</span> <span class="n">EC</span>
<span class="kn">from</span> <span class="nn">selenium.webdriver.support.ui</span> <span class="k">import</span> <span class="n">WebDriverWait</span>

<span class="kn">from</span> <span class="nn">.objects.chat</span> <span class="k">import</span> <span class="n">Chat</span><span class="p">,</span> <span class="n">UserChat</span><span class="p">,</span> <span class="n">factory_chat</span>
<span class="kn">from</span> <span class="nn">.objects.contact</span> <span class="k">import</span> <span class="n">Contact</span>
<span class="kn">from</span> <span class="nn">.objects.message</span> <span class="k">import</span> <span class="n">MessageGroup</span><span class="p">,</span> <span class="n">factory_message</span>
<span class="kn">from</span> <span class="nn">.wapi_js_wrapper</span> <span class="k">import</span> <span class="n">WapiJsWrapper</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;2.0.3&#39;</span>


<span class="k">class</span> <span class="nc">WhatsAPIDriverStatus</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">Unknown</span> <span class="o">=</span> <span class="s1">&#39;Unknown&#39;</span>
    <span class="n">NoDriver</span> <span class="o">=</span> <span class="s1">&#39;NoDriver&#39;</span>
    <span class="n">NotConnected</span> <span class="o">=</span> <span class="s1">&#39;NotConnected&#39;</span>
    <span class="n">NotLoggedIn</span> <span class="o">=</span> <span class="s1">&#39;NotLoggedIn&#39;</span>
    <span class="n">LoggedIn</span> <span class="o">=</span> <span class="s1">&#39;LoggedIn&#39;</span>


<div class="viewcode-block" id="WhatsAPIException"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIException">[docs]</a><span class="k">class</span> <span class="nc">WhatsAPIException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ChatNotFoundError"><a class="viewcode-back" href="../index.html#webwhatsapi.ChatNotFoundError">[docs]</a><span class="k">class</span> <span class="nc">ChatNotFoundError</span><span class="p">(</span><span class="n">WhatsAPIException</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="ContactNotFoundError"><a class="viewcode-back" href="../index.html#webwhatsapi.ContactNotFoundError">[docs]</a><span class="k">class</span> <span class="nc">ContactNotFoundError</span><span class="p">(</span><span class="n">WhatsAPIException</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="WhatsAPIDriver"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver">[docs]</a><span class="k">class</span> <span class="nc">WhatsAPIDriver</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is our main driver objects.</span>
<span class="sd">        .. note::</span>
<span class="sd">           Runs its own instance of selenium</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="n">_PROXY</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_URL</span> <span class="o">=</span> <span class="s2">&quot;https://web.whatsapp.com&quot;</span>

    <span class="n">_LOCAL_STORAGE_FILE</span> <span class="o">=</span> <span class="s1">&#39;localStorage.json&#39;</span>

    <span class="n">_SELECTORS</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;firstrun&#39;</span><span class="p">:</span> <span class="s2">&quot;#wrapper&quot;</span><span class="p">,</span>
        <span class="s1">&#39;qrCode&#39;</span><span class="p">:</span> <span class="s2">&quot;img[alt=</span><span class="se">\&quot;</span><span class="s2">Scan me!</span><span class="se">\&quot;</span><span class="s2">]&quot;</span><span class="p">,</span>
        <span class="s1">&#39;qrCodePlain&#39;</span><span class="p">:</span> <span class="s2">&quot;._2EZ_m&quot;</span><span class="p">,</span>
        <span class="s1">&#39;mainPage&#39;</span><span class="p">:</span> <span class="s2">&quot;.app.two&quot;</span><span class="p">,</span>
        <span class="s1">&#39;chatList&#39;</span><span class="p">:</span> <span class="s2">&quot;.infinite-list-viewport&quot;</span><span class="p">,</span>
        <span class="s1">&#39;messageList&#39;</span><span class="p">:</span> <span class="s2">&quot;#main &gt; div &gt; div:nth-child(1) &gt; div &gt; div.message-list&quot;</span><span class="p">,</span>
        <span class="s1">&#39;unreadMessageBar&#39;</span><span class="p">:</span> <span class="s2">&quot;#main &gt; div &gt; div:nth-child(1) &gt; div &gt; div.message-list &gt; div.msg-unread&quot;</span><span class="p">,</span>
        <span class="s1">&#39;searchBar&#39;</span><span class="p">:</span> <span class="s2">&quot;.input&quot;</span><span class="p">,</span>
        <span class="s1">&#39;searchCancel&#39;</span><span class="p">:</span> <span class="s2">&quot;.icon-search-morph&quot;</span><span class="p">,</span>
        <span class="s1">&#39;chats&#39;</span><span class="p">:</span> <span class="s2">&quot;.infinite-list-item&quot;</span><span class="p">,</span>
        <span class="s1">&#39;chatBar&#39;</span><span class="p">:</span> <span class="s1">&#39;div.input&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sendButton&#39;</span><span class="p">:</span> <span class="s1">&#39;button.icon:nth-child(3)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;LoadHistory&#39;</span><span class="p">:</span> <span class="s1">&#39;.btn-more&#39;</span><span class="p">,</span>
        <span class="s1">&#39;UnreadBadge&#39;</span><span class="p">:</span> <span class="s1">&#39;.icon-meta&#39;</span><span class="p">,</span>
        <span class="s1">&#39;UnreadChatBanner&#39;</span><span class="p">:</span> <span class="s1">&#39;.message-list&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ReconnectLink&#39;</span><span class="p">:</span> <span class="s1">&#39;.action&#39;</span><span class="p">,</span>
        <span class="s1">&#39;WhatsappQrIcon&#39;</span><span class="p">:</span> <span class="s1">&#39;span.icon:nth-child(2)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;QRReloader&#39;</span><span class="p">:</span> <span class="s1">&#39;.qr-wrapper-container&#39;</span>
    <span class="p">}</span>

    <span class="n">_CLASSES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;unreadBadge&#39;</span><span class="p">:</span> <span class="s1">&#39;icon-meta&#39;</span><span class="p">,</span>
        <span class="s1">&#39;messageContent&#39;</span><span class="p">:</span> <span class="s2">&quot;message-text&quot;</span><span class="p">,</span>
        <span class="s1">&#39;messageList&#39;</span><span class="p">:</span> <span class="s2">&quot;msg&quot;</span>
    <span class="p">}</span>

    <span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">driver</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Profile points to the Firefox profile for firefox and Chrome cache for chrome</span>
    <span class="c1"># Do not alter this</span>
    <span class="n">_profile</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">get_local_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s1">&#39;return window.localStorage;&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_local_storage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">execute_script</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;window.localStorage.setItem(&#39;</span><span class="si">{}</span><span class="s2">&#39;, &#39;</span><span class="si">{}</span><span class="s2">&#39;);&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()]))</span>

<div class="viewcode-block" id="WhatsAPIDriver.save_firefox_profile"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.save_firefox_profile">[docs]</a>    <span class="k">def</span> <span class="nf">save_firefox_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">remove_old</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Function to save the firefox profile to the permanant one&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Saving profile from </span><span class="si">%s</span><span class="s2"> to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">remove_old</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">OSError</span><span class="p">:</span>
                    <span class="k">pass</span>

            <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">path</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">,</span>
                            <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;parent.lock&quot;</span><span class="p">,</span> <span class="s2">&quot;lock&quot;</span><span class="p">,</span> <span class="s2">&quot;.parentlock&quot;</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">path</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;parent.lock&quot;</span><span class="p">,</span> <span class="s2">&quot;lock&quot;</span><span class="p">,</span> <span class="s2">&quot;.parentlock&quot;</span><span class="p">]:</span>
                    <span class="k">continue</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="n">d</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span>
                                    <span class="n">ignore</span><span class="o">=</span><span class="n">shutil</span><span class="o">.</span><span class="n">ignore_patterns</span><span class="p">(</span><span class="s2">&quot;parent.lock&quot;</span><span class="p">,</span> <span class="s2">&quot;lock&quot;</span><span class="p">,</span> <span class="s2">&quot;.parentlock&quot;</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy2</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LOCAL_STORAGE_FILE</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_local_storage</span><span class="p">()))</span></div>

    <span class="k">def</span> <span class="nf">set_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting proxy to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">proxy</span><span class="p">)</span>
        <span class="n">proxy_address</span><span class="p">,</span> <span class="n">proxy_port</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;network.proxy.type&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;network.proxy.http&quot;</span><span class="p">,</span> <span class="n">proxy_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;network.proxy.http_port&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">proxy_port</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;network.proxy.ssl&quot;</span><span class="p">,</span> <span class="n">proxy_address</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s2">&quot;network.proxy.ssl_port&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">proxy_port</span><span class="p">))</span>

<div class="viewcode-block" id="WhatsAPIDriver.close"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Closes the selenium instance&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client</span><span class="o">=</span><span class="s2">&quot;firefox&quot;</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="s2">&quot;API&quot;</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">command_executor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">loadstyles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">profile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headless</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autoconnect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extra_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">chrome_options</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initialises the webdriver&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">logger</span>
        <span class="n">extra_params</span> <span class="o">=</span> <span class="n">extra_params</span> <span class="ow">or</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">profile</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span> <span class="o">=</span> <span class="n">profile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Checking for profile at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;Could not find profile at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">profile</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">WhatsAPIException</span><span class="p">(</span><span class="s2">&quot;Could not find profile at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">profile</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">==</span> <span class="s2">&quot;firefox&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">FirefoxProfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">FirefoxProfile</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">loadstyles</span><span class="p">:</span>
                <span class="c1"># Disable CSS</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s1">&#39;permissions.default.stylesheet&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="c1"># Disable images</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s1">&#39;permissions.default.image&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
                <span class="c1"># Disable Flash</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">set_preference</span><span class="p">(</span><span class="s1">&#39;dom.ipc.plugins.enabled.libflashplayer.so&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;false&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_proxy</span><span class="p">(</span><span class="n">proxy</span><span class="p">)</span>

            <span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">headless</span><span class="p">:</span>
                <span class="n">options</span><span class="o">.</span><span class="n">set_headless</span><span class="p">()</span>

            <span class="n">options</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span>

            <span class="n">capabilities</span> <span class="o">=</span> <span class="n">DesiredCapabilities</span><span class="o">.</span><span class="n">FIREFOX</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">capabilities</span><span class="p">[</span><span class="s1">&#39;webStorageEnabled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting webdriver&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Firefox</span><span class="p">(</span><span class="n">capabilities</span><span class="o">=</span><span class="n">capabilities</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_params</span><span class="p">)</span>

        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">==</span> <span class="s2">&quot;chrome&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">chrome</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">Options</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;user-data-dir=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">proxy</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">profile</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;--proxy-server=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">proxy</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">chrome_options</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">option</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Chrome</span><span class="p">(</span><span class="n">chrome_options</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="p">,</span> <span class="o">**</span><span class="n">extra_params</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">client</span> <span class="o">==</span> <span class="s1">&#39;remote&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">FirefoxProfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile_path</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_profile</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">FirefoxProfile</span><span class="p">()</span>
            <span class="n">capabilities</span> <span class="o">=</span> <span class="n">DesiredCapabilities</span><span class="o">.</span><span class="n">FIREFOX</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">webdriver</span><span class="o">.</span><span class="n">Remote</span><span class="p">(</span>
                <span class="n">command_executor</span><span class="o">=</span><span class="n">command_executor</span><span class="p">,</span>
                <span class="n">desired_capabilities</span><span class="o">=</span><span class="n">capabilities</span><span class="p">,</span>
                <span class="o">**</span><span class="n">extra_params</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Invalid client: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">client</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span> <span class="o">=</span> <span class="n">WapiJsWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">set_script_timeout</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">implicitly_wait</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">autoconnect</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_URL</span><span class="p">)</span>

        <span class="n">local_storage_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_profile</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_LOCAL_STORAGE_FILE</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">local_storage_file</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">local_storage_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_local_storage</span><span class="p">(</span><span class="n">loads</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>

<div class="viewcode-block" id="WhatsAPIDriver.is_logged_in"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.is_logged_in">[docs]</a>    <span class="k">def</span> <span class="nf">is_logged_in</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns if user is logged. Can be used if non-block needed for wait_for_login&quot;&quot;&quot;</span>

        <span class="c1"># self.driver.find_element_by_css_selector(self._SELECTORS[&#39;mainPage&#39;])</span>
        <span class="c1"># it becomes ridiculously slow if the element is not found.</span>

        <span class="c1"># instead we use this (temporary) solution:</span>
        <span class="k">return</span> <span class="s1">&#39;class=&quot;app _3dqpi two&quot;&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.wait_for_login"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.wait_for_login">[docs]</a>    <span class="k">def</span> <span class="nf">wait_for_login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">90</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Waits for the QR to go away&quot;&quot;&quot;</span>
        <span class="n">WebDriverWait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span><span class="o">.</span><span class="n">until</span><span class="p">(</span>
            <span class="n">EC</span><span class="o">.</span><span class="n">visibility_of_element_located</span><span class="p">((</span><span class="n">By</span><span class="o">.</span><span class="n">CSS_SELECTOR</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_SELECTORS</span><span class="p">[</span><span class="s1">&#39;mainPage&#39;</span><span class="p">]))</span>
        <span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">get_qr_plain</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SELECTORS</span><span class="p">[</span><span class="s1">&#39;qrCodePlain&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">get_attribute</span><span class="p">(</span><span class="s2">&quot;data-ref&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="WhatsAPIDriver.get_qr"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_qr">[docs]</a>    <span class="k">def</span> <span class="nf">get_qr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get pairing QR code from client&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;Click to reload QR code&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">page_source</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reload_qr</span><span class="p">()</span>
        <span class="n">qr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SELECTORS</span><span class="p">[</span><span class="s1">&#39;qrCode&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fd</span><span class="p">,</span> <span class="n">fn_png</span> <span class="o">=</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">mkstemp</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.png&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">O_RDWR</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span>
            <span class="n">fn_png</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;QRcode image saved at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">fn_png</span><span class="p">)</span>
        <span class="n">qr</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="n">fn_png</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fn_png</span></div>

    <span class="k">def</span> <span class="nf">screenshot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get_screenshot_as_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<div class="viewcode-block" id="WhatsAPIDriver.get_contacts"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_contacts">[docs]</a>    <span class="k">def</span> <span class="nf">get_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches list of all contacts</span>
<span class="sd">        This will return chats with people from the address book only</span>
<span class="sd">        Use get_all_chats for all chats</span>

<span class="sd">        :return: List of contacts</span>
<span class="sd">        :rtype: list[Contact]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getAllContacts</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Contact</span><span class="p">(</span><span class="n">contact</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="n">all_contacts</span><span class="p">]</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_my_contacts"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_my_contacts">[docs]</a>    <span class="k">def</span> <span class="nf">get_my_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches list of added contacts</span>

<span class="sd">        :return: List of contacts</span>
<span class="sd">        :rtype: list[Contact]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">my_contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getMyContacts</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">Contact</span><span class="p">(</span><span class="n">contact</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">contact</span> <span class="ow">in</span> <span class="n">my_contacts</span><span class="p">]</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_all_chats"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_all_chats">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_chats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches all chats</span>

<span class="sd">        :return: List of chats</span>
<span class="sd">        :rtype: list[Chat]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">factory_chat</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">chat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getAllChats</span><span class="p">()]</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_all_chat_ids"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_all_chat_ids">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_chat_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches all chat ids</span>

<span class="sd">        :return: List of chat ids</span>
<span class="sd">        :rtype: list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getAllChatIds</span><span class="p">()</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_unread"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_unread">[docs]</a>    <span class="k">def</span> <span class="nf">get_unread</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include_me</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_notifications</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">use_unread_count</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches unread messages</span>

<span class="sd">        :param include_me: Include user&#39;s messages</span>
<span class="sd">        :type include_me: bool or None</span>
<span class="sd">        :param include_notifications: Include events happening on chat</span>
<span class="sd">        :type include_notifications: bool or None</span>
<span class="sd">        :param use_unread_count: If set uses chat&#39;s &#39;unreadCount&#39; attribute to fetch last n messages from chat</span>
<span class="sd">        :type use_unread_count: bool</span>
<span class="sd">        :return: List of unread messages grouped by chats</span>
<span class="sd">        :rtype: list[MessageGroup]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">raw_message_groups</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getUnreadMessages</span><span class="p">(</span><span class="n">include_me</span><span class="p">,</span> <span class="n">include_notifications</span><span class="p">,</span> <span class="n">use_unread_count</span><span class="p">)</span>

        <span class="n">unread_messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">raw_message_group</span> <span class="ow">in</span> <span class="n">raw_message_groups</span><span class="p">:</span>
            <span class="n">chat</span> <span class="o">=</span> <span class="n">factory_chat</span><span class="p">(</span><span class="n">raw_message_group</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="n">messages</span> <span class="o">=</span> <span class="p">[</span><span class="n">factory_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">raw_message_group</span><span class="p">[</span><span class="s1">&#39;messages&#39;</span><span class="p">]]</span>
            <span class="n">unread_messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MessageGroup</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="n">messages</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">unread_messages</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_unread_messages_in_chat"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_unread_messages_in_chat">[docs]</a>    <span class="k">def</span> <span class="nf">get_unread_messages_in_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="nb">id</span><span class="p">,</span>
                                    <span class="n">include_me</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                    <span class="n">include_notifications</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        I fetch unread messages from an asked chat.</span>

<span class="sd">        :param id: chat id</span>
<span class="sd">        :type  id: str</span>
<span class="sd">        :param include_me: if user&#39;s messages are to be included</span>
<span class="sd">        :type  include_me: bool</span>
<span class="sd">        :param include_notifications: if events happening on chat are to be included</span>
<span class="sd">        :type  include_notifications: bool</span>
<span class="sd">        :return: list of unread messages from asked chat</span>
<span class="sd">        :rtype: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get unread messages</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getUnreadMessagesInChat</span><span class="p">(</span>
            <span class="nb">id</span><span class="p">,</span>
            <span class="n">include_me</span><span class="p">,</span>
            <span class="n">include_notifications</span>
        <span class="p">)</span>

        <span class="c1"># process them</span>
        <span class="n">unread</span> <span class="o">=</span> <span class="p">[</span><span class="n">factory_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span> <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">messages</span><span class="p">]</span>

        <span class="c1"># return them</span>
        <span class="k">return</span> <span class="n">unread</span></div>

    <span class="c1"># get_unread_messages_in_chat()</span>

<div class="viewcode-block" id="WhatsAPIDriver.get_all_messages_in_chat"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_all_messages_in_chat">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_messages_in_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat</span><span class="p">,</span> <span class="n">include_me</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_notifications</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches messages in chat</span>

<span class="sd">        :param include_me: Include user&#39;s messages</span>
<span class="sd">        :type include_me: bool or None</span>
<span class="sd">        :param include_notifications: Include events happening on chat</span>
<span class="sd">        :type include_notifications: bool or None</span>
<span class="sd">        :return: List of messages in chat</span>
<span class="sd">        :rtype: list[Message]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">message_objs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getAllMessagesInChat</span><span class="p">(</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">include_me</span><span class="p">,</span> <span class="n">include_notifications</span><span class="p">)</span>

        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">message_objs</span><span class="p">:</span>
            <span class="k">yield</span><span class="p">(</span><span class="n">factory_message</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_all_message_ids_in_chat"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_all_message_ids_in_chat">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_message_ids_in_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat</span><span class="p">,</span> <span class="n">include_me</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">include_notifications</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches message ids in chat</span>

<span class="sd">        :param include_me: Include user&#39;s messages</span>
<span class="sd">        :type include_me: bool or None</span>
<span class="sd">        :param include_notifications: Include events happening on chat</span>
<span class="sd">        :type include_notifications: bool or None</span>
<span class="sd">        :return: List of message ids in chat</span>
<span class="sd">        :rtype: list[str]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getAllMessageIdsInChat</span><span class="p">(</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">include_me</span><span class="p">,</span> <span class="n">include_notifications</span><span class="p">)</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_message_by_id"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_message_by_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_message_by_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch a message</span>

<span class="sd">        :param message_id: Message ID</span>
<span class="sd">        :type message_id: str</span>
<span class="sd">        :return: Message or False</span>
<span class="sd">        :rtype: Message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getMessageById</span><span class="p">(</span><span class="n">message_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">factory_message</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_contact_from_id"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_contact_from_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_contact_from_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contact_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches a contact given its ID</span>

<span class="sd">        :param contact_id: Contact ID</span>
<span class="sd">        :type contact_id: str</span>
<span class="sd">        :return: Contact or Error</span>
<span class="sd">        :rtype: Contact</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">contact</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getContact</span><span class="p">(</span><span class="n">contact_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">contact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ContactNotFoundError</span><span class="p">(</span><span class="s2">&quot;Contact </span><span class="si">{0}</span><span class="s2"> not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">contact_id</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">Contact</span><span class="p">(</span><span class="n">contact</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_chat_from_id"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_chat_from_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_chat_from_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches a chat given its ID</span>

<span class="sd">        :param chat_id: Chat ID</span>
<span class="sd">        :type chat_id: str</span>
<span class="sd">        :return: Chat or Error</span>
<span class="sd">        :rtype: Chat</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">chat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getChatById</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">chat</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">factory_chat</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">ChatNotFoundError</span><span class="p">(</span><span class="s2">&quot;Chat </span><span class="si">{0}</span><span class="s2"> not found&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">chat_id</span><span class="p">))</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_chat_from_phone_number"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_chat_from_phone_number">[docs]</a>    <span class="k">def</span> <span class="nf">get_chat_from_phone_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets chat by phone number</span>
<span class="sd">        Number format should be as it appears in Whatsapp ID</span>
<span class="sd">        For example, for the number:</span>
<span class="sd">        +972-51-234-5678</span>
<span class="sd">        This function would receive:</span>
<span class="sd">        972512345678</span>

<span class="sd">        :param number: Phone number</span>
<span class="sd">        :return: Chat</span>
<span class="sd">        :rtype: Chat</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">chat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_chats</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="n">UserChat</span><span class="p">)</span> <span class="ow">or</span> <span class="n">number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">return</span> <span class="n">chat</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">create_chat_by_number</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wait_for_login</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">chat</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_all_chats</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chat</span><span class="p">,</span> <span class="n">UserChat</span><span class="p">)</span> <span class="ow">or</span> <span class="n">number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">return</span> <span class="n">chat</span>
        <span class="k">raise</span> <span class="n">ChatNotFoundError</span><span class="p">(</span><span class="s1">&#39;Chat for phone </span><span class="si">{0}</span><span class="s1"> not found&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">number</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">reload_qr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SELECTORS</span><span class="p">[</span><span class="s1">&#39;qrCode&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">click</span><span class="p">()</span>

<div class="viewcode-block" id="WhatsAPIDriver.get_status"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_status">[docs]</a>    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns status of the driver</span>

<span class="sd">        :return: Status</span>
<span class="sd">        :rtype: WhatsAPIDriverStatus</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">WhatsAPIDriverStatus</span><span class="o">.</span><span class="n">NotConnected</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">session_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">WhatsAPIDriverStatus</span><span class="o">.</span><span class="n">NotConnected</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SELECTORS</span><span class="p">[</span><span class="s1">&#39;mainPage&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">WhatsAPIDriverStatus</span><span class="o">.</span><span class="n">LoggedIn</span>
        <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">find_element_by_css_selector</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_SELECTORS</span><span class="p">[</span><span class="s1">&#39;qrCode&#39;</span><span class="p">])</span>
            <span class="k">return</span> <span class="n">WhatsAPIDriverStatus</span><span class="o">.</span><span class="n">NotLoggedIn</span>
        <span class="k">except</span> <span class="n">NoSuchElementException</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">return</span> <span class="n">WhatsAPIDriverStatus</span><span class="o">.</span><span class="n">Unknown</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.contact_get_common_groups"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.contact_get_common_groups">[docs]</a>    <span class="k">def</span> <span class="nf">contact_get_common_groups</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">contact_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns groups common between a user and the contact with given id.</span>

<span class="sd">        :return: Contact or Error</span>
<span class="sd">        :rtype: Contact</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getCommonGroups</span><span class="p">(</span><span class="n">contact_id</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">factory_chat</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">chat_send_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span><span class="n">chat_id</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">factory_message</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="WhatsAPIDriver.send_message_to_id"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.send_message_to_id">[docs]</a>    <span class="k">def</span> <span class="nf">send_message_to_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recipient</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a message to a chat given its ID</span>

<span class="sd">        :param recipient: Chat ID</span>
<span class="sd">        :type recipient: str</span>
<span class="sd">        :param message: Plain-text message to be sent.</span>
<span class="sd">        :type message: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">sendMessageToID</span><span class="p">(</span><span class="n">recipient</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.chat_send_seen"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.chat_send_seen">[docs]</a>    <span class="k">def</span> <span class="nf">chat_send_seen</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a seen to a chat given its ID</span>

<span class="sd">        :param chat_id: Chat ID</span>
<span class="sd">        :type chat_id: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">sendSeen</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">chat_load_earlier_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">loadEarlierMessages</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">chat_load_all_earlier_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">loadAllEarlierMessages</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">async_chat_load_all_earlier_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">asyncLoadAllEarlierMessages</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">are_all_messages_loaded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">areAllMessagesLoaded</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">group_get_participants_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getGroupParticipantIDs</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">group_get_participants</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">):</span>
        <span class="n">participant_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_get_participants_ids</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">participant_id</span> <span class="ow">in</span> <span class="n">participant_ids</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contact_from_id</span><span class="p">(</span><span class="n">participant_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">group_get_admin_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getGroupAdmins</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">group_get_admins</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">group_id</span><span class="p">):</span>
        <span class="n">admin_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">group_get_admin_ids</span><span class="p">(</span><span class="n">group_id</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">admin_id</span> <span class="ow">in</span> <span class="n">admin_ids</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contact_from_id</span><span class="p">(</span><span class="n">admin_id</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">b64decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">downloadFile</span><span class="p">(</span><span class="n">url</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">download_media</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">media_msg</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">media_msg</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">b64decode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">file_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">media_msg</span><span class="o">.</span><span class="n">client_url</span><span class="p">)</span>

        <span class="n">media_key</span> <span class="o">=</span> <span class="n">b64decode</span><span class="p">(</span><span class="n">media_msg</span><span class="o">.</span><span class="n">media_key</span><span class="p">)</span>
        <span class="n">derivative</span> <span class="o">=</span> <span class="n">HKDFv3</span><span class="p">()</span><span class="o">.</span><span class="n">deriveSecrets</span><span class="p">(</span><span class="n">media_key</span><span class="p">,</span>
                                            <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">media_msg</span><span class="o">.</span><span class="n">crypt_keys</span><span class="p">[</span><span class="n">media_msg</span><span class="o">.</span><span class="n">type</span><span class="p">]),</span>
                                            <span class="mi">112</span><span class="p">)</span>

        <span class="n">parts</span> <span class="o">=</span> <span class="n">ByteUtil</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">derivative</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="n">iv</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">cipher_key</span> <span class="o">=</span> <span class="n">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">e_file</span> <span class="o">=</span> <span class="n">file_data</span><span class="p">[:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span>

        <span class="n">cr_obj</span> <span class="o">=</span> <span class="n">Cipher</span><span class="p">(</span><span class="n">algorithms</span><span class="o">.</span><span class="n">AES</span><span class="p">(</span><span class="n">cipher_key</span><span class="p">),</span> <span class="n">modes</span><span class="o">.</span><span class="n">CBC</span><span class="p">(</span><span class="n">iv</span><span class="p">),</span> <span class="n">backend</span><span class="o">=</span><span class="n">default_backend</span><span class="p">())</span>
        <span class="n">decryptor</span> <span class="o">=</span> <span class="n">cr_obj</span><span class="o">.</span><span class="n">decryptor</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">BytesIO</span><span class="p">(</span><span class="n">decryptor</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">e_file</span><span class="p">)</span> <span class="o">+</span> <span class="n">decryptor</span><span class="o">.</span><span class="n">finalize</span><span class="p">())</span>

<div class="viewcode-block" id="WhatsAPIDriver.mark_default_unread_messages"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.mark_default_unread_messages">[docs]</a>    <span class="k">def</span> <span class="nf">mark_default_unread_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Look for the latest unreplied messages received and mark them as unread.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">markDefaultUnreadMessages</span><span class="p">()</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.get_battery_level"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.get_battery_level">[docs]</a>    <span class="k">def</span> <span class="nf">get_battery_level</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check the battery level of device</span>

<span class="sd">        :return: int: Battery level</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">getBatteryLevel</span><span class="p">()</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.leave_group"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.leave_group">[docs]</a>    <span class="k">def</span> <span class="nf">leave_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Leave a group</span>

<span class="sd">        :param chat_id: id of group</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">leaveGroup</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span></div>

<div class="viewcode-block" id="WhatsAPIDriver.delete_chat"><a class="viewcode-back" href="../index.html#webwhatsapi.WhatsAPIDriver.delete_chat">[docs]</a>    <span class="k">def</span> <span class="nf">delete_chat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chat_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Delete a chat</span>

<span class="sd">        :param chat_id: id of chat</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">wapi_functions</span><span class="o">.</span><span class="n">deleteConversation</span><span class="p">(</span><span class="n">chat_id</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">quit</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">quit</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">create_chat_by_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">number</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_URL</span> <span class="o">+</span> <span class="s2">&quot;/send?phone=&quot;</span> <span class="o">+</span> <span class="n">number</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Mukul Hase, Adarsh Sanjeev.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.7.4</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>